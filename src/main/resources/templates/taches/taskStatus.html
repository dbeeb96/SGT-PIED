<!DOCTYPE html>
<html lang="en"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="_layout">
<!-- Include Bootstrap CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
<!-- Include Sortable.js CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.css">
<title>Task Status</title>
<body>

<div layout:fragment="content">
    <section class="wrapper">
        <div class="row">
            <div class="col-lg-12">
                <h3 class="page-header"><i class="fa fa fa-bars"></i>Status des taches</h3>
                <ol class="breadcrumb">
                    <li><i class="fa fa-home"></i><a href="/helpdesk">Accueil</a></li>
                    <li><i class="fa fa-bars"></i><a href="/helpdesk/tasks">tasks</a></li>
                    <li><i class="fa fa-square-o"></i>Satus des taches</li>
                </ol>
            </div>
        </div>
        <div class="container">

            <section class="panel">
                <!-- Container for task status columns -->
                <div class="container mt-4">

                    <!-- Status columns for drag-and-drop using Bootstrap grid system -->
                    <div class="row">
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="card-title">À FAIRE</h5>
                                </div>
                                <div class="card-body sortable" th:each="task : ${tasks}" th:if="${task.status == 'TODO'}" th:attr="data-task-id=${task.id}">
                                    <div class="card">
                                        <div class="card-body">
                                            <!-- Task card content here -->
                                            <p class="card-text" th:text="${task.title}"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <!-- Repeat similar structure for other status columns -->
                            <div class="card">
                                <div class="card-header bg-warning">
                                    <h5 class="card-title">EN COURS</h5>
                                </div>
                                <div class="card-body sortable" th:each="task : ${tasks}" th:if="${task.status == 'IN_PROGRESS'}" th:attr="data-task-id=${task.id}">
                                    <div class="card">
                                        <div class="card-body">
                                            <!-- Task card content here -->
                                            <p class="card-text" th:text="${task.title}"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-header bg-success text-white">
                                    <h5 class="card-title">TERMINÉE</h5>
                                </div>
                                <div class="card-body sortable" th:each="task : ${tasks}" th:if="${task.status == 'DONE'}" th:attr="data-task-id=${task.id}">
                                    <div class="card">
                                        <div class="card-body">
                                            <!-- Task card content here -->
                                            <p class="card-text" th:text="${task.title}"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-header bg-danger text-white">
                                    <h5 class="card-title">PROBLÈME</h5>
                                </div>
                                <div class="card-body sortable" th:each="task : ${tasks}" th:if="${task.status == 'ISSUE'}" th:attr="data-task-id=${task.id}">
                                    <div class="card">
                                        <div class="card-body">
                                            <!-- Task card content here -->
                                            <p class="card-text" th:text="${task.title}"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </section>

        </div>
    </section>
</div>

<!-- Include Bootstrap and Sortable.js scripts -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>

<!-- Initialize Sortable for each status column -->
<script>
    document.querySelectorAll('.sortable').forEach(function (column) {
        new Sortable(column, {
            group: 'status', // Group tasks by status
            animation: 150,
            onEnd: function (evt) {
                // Handle the task drop event
                var taskId = evt.item.getAttribute('data-task-id');
                var newStatus = evt.to.id.replace('-column', ''); // Extract the new status from the column ID

                // Update the task status on the server
                updateTaskStatus(taskId, newStatus);
            }
        });
    });

    // Function to update task status on the server
    function updateTaskStatus(taskId, newStatus) {
        // Use AJAX or Fetch API to send a request to your Spring Boot backend
        fetch('/tasks/updateStatus', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'taskId=' + encodeURIComponent(taskId) + '&newStatus=' + encodeURIComponent(newStatus),
        })
            .then(response => {
                if (response.ok) {
                    console.log('Task status updated successfully');
                } else {
                    console.error('Failed to update task status');
                }
            })
            .catch(error => {
                console.error('Error updating task status:', error);
            });
    }
</script>


</body>
</html>
