<!DOCTYPE html>
<html lang="en" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="_layout">

<body>
<div layout:fragment="content">
    <section class="wrapper">
        <div class="row">
            <div class="col-lg-12">
                <h3 class="page-header"><i class="fa fa fa-bars"></i>Status des taches</h3>
                <ol class="breadcrumb">
                    <li><i class="fa fa-home"></i><a href="/helpdesk">Accueil</a></li>
                    <li><i class="fa fa-bars"></i><a href="/helpdesk/tasks">tasks</a></li>
                    <li><i class="fa fa-square-o"></i>Satus des taches</li>
                </ol>
            </div>
        </div>
        <div class="container">
            <!--Style -->

              <style>
                  .card-1{
                     background: none;
                  }
                  .card-title{
                      margin-top: 12px;
                  }
              </style>

            <!--- fin du style  ---->
            <!-- TaskStatus.html -->
            <section class="panel">
                <!-- Container for task status columns and rows -->
                <div class="container mt-4">

                    <!-- Status columns for drag-and-drop using Bootstrap grid system -->
                    <div class="row" style="background-color: #0e2e42 !important;">
                        <div class="col-md-3">
                            <div class="card card-1">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="card-title">À FAIRE</h5>
                                </div>
                                <!-- Display tasks with status 'TODO' -->
                                <div class="card-body sortable" th:each="task : ${todoTasks}" th:attr="data-task-id=${task.id}">
                                    <div class="card" draggable="true">
                                        <div class="card-body">
                                            <!-- Display only the title with a light background color -->
                                            <div style="background-color: #f2f2f2; padding: 8px; border-bottom: 1px solid #ddd;">
                                                <h5 class="card-title">
                                                    <span th:text="${task.title}"></span>
                                                </h5>
                                            </div>

                                            <!-- Display the description -->
                                            <p class="card-text task-details">
                                                <span th:text="${task.description}"></span>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Repeat similar structure for other status columns and rows -->
                        <div class="col-md-3 ">
                            <div class="card card-1">
                                <div class="card-header bg-warning">
                                    <h5 class="card-title">EN COURS</h5>
                                </div>
                                <div class="card-body sortable" th:each="task : ${inProgressTasks}" th:attr="data-task-id=${task.id}">
                                    <div class="card" draggable="true">
                                        <div class="card-body">
                                            <div style="background-color: #f2f2f2; padding: 8px; border-bottom: 1px solid #ddd;">
                                                <h5 class="card-title">
                                                    <span th:text="${task.title}"></span>
                                                </h5>
                                            </div>
                                            <p class="card-text task-details">
                                                <span th:text="${task.description}"></span>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3 ">
                            <div class="card card-1">
                                <div class="card-header bg-success text-white">
                                    <h5 class="card-title">TERMINÉE</h5>
                                </div>
                                <div class="card-body sortable" th:each="task : ${doneTasks}" th:attr="data-task-id=${task.id}">
                                    <div class="card" draggable="true">
                                        <div class="card-body">
                                            <div style="background-color: #f2f2f2; padding: 8px; border-bottom: 1px solid #ddd;">
                                                <h5 class="card-title">
                                                    <span th:text="${task.title}"></span>
                                                </h5>
                                            </div>
                                            <p class="card-text task-details">
                                                <span th:text="${task.description}"></span>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="card card-1">
                                <div class="card-header bg-danger text-white">
                                    <h5 class="card-title">PROBLÈME</h5>
                                </div>
                                <div class="card-body sortable" th:each="task : ${issueTasks}" th:attr="data-task-id=${task.id}">
                                    <div class="card" draggable="true">
                                        <div class="card-body">
                                            <div style="background-color: #f2f2f2; padding: 8px; border-bottom: 1px solid #ddd;">
                                                <h5 class="card-title">
                                                    <span th:text="${task.title}"></span>
                                                </h5>
                                            </div>
                                            <p class="card-text task-details">
                                                <span th:text="${task.description}"></span>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </section>
</div>

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="https://cdn.rawgit.com/RubaXa/Sortable/v1.14.0/Sortable.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const statusCards = document.querySelectorAll('.card-body.sortable');

        statusCards.forEach(function (card) {
            new Sortable(card, {
                group: 'status', // Group tasks by status
                animation: 150,
                onEnd: function (evt) {
                    const taskId = evt.item.getAttribute('data-task-id');
                    const newStatus = evt.to.closest('.card').querySelector('.card-header').innerText.trim();
                    updateTaskStatus(taskId, newStatus);
                }
            });

            card.addEventListener('dragover', function (event) {
                event.preventDefault();
            });

            card.addEventListener('drop', function (event) {
                event.preventDefault();
                const taskId = event.dataTransfer.getData('text/plain');
                const taskCard = document.querySelector('[data-task-id="' + taskId + '"]');
                card.appendChild(taskCard);
                const newStatus = card.closest('.card').querySelector('.card-header').innerText.trim();
                updateTaskStatus(taskId, newStatus);
            });
        });
    });

    function updateTaskStatus(taskId, newStatus) {
        console.log('Updating task status...', taskId, newStatus);
        // Use AJAX or Fetch API to send a request to your Spring Boot backend
        // Example fetch:
        /*
        fetch('/tasks/updateStatus', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'taskId=' + encodeURIComponent(taskId) + '&newStatus=' + encodeURIComponent(newStatus),
        })
            .then(response => {
                if (response.ok) {
                    console.log('Task status updated successfully');
                } else {
                    console.error('Failed to update task status');
                }
            })
            .catch(error => {
                console.error('Error updating task status:', error);
            });
        */
    }
</script>

</body>
</html>
